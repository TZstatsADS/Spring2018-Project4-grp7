---
title: "Project 4 main"
author: "Group7"
date: "4/16/2018"
output: html_document
---

# Memory-Based Algorithm

## Load Organized Data

We have already organized data before
```{r}
# You can check code in 'movie_organize.Rmd' in lib
# movie_train <- read.csv("../data/movie_train.csv")
# movie_test <- read.csv("../data/movie_test.csv")

```


## Calculate similarity weights 

Pearson Correlation & Vector Similarity & SimRank
```{r}

# Movie

# You can check code in 'pearson_vector.Rmd' in lib
# load("../output/weight/movie_train_pearson.RData")
# load("../output/weight/movie_train_vector.RData")

 
# MS

# You can check code in 'pearson_vector.Rmd' in lib
# load("../output/weight/ms_train_pearson.RData")
# load("../output/weight/ms_train_vector.RData")


```


## Select neighborhood and Prediction
```{r}
# Movie

# #movie_pearson_threshold
# neighborhood <- weight_thre(movie_train_pearson)
# movie_pearson_threshold <- movie_predict(similarity = movie_train_pearson)
# save(movie_pearson_threshold,file = "movie_pearson_threshold.RData")
# #movie_vector_threshold
# neighborhood <- weight_thre(movie_train_vector)
# movie_vector_threshold <- movie_predict(similarity = movie_train_vector)
# save(movie_vector_threshold,file = "movie_vector_threshold.RData")
# #movie_simrank_threshold
# neighborhood <- weight_thre(movie_train_simrank)
# movie_simrank_threshold <- movie_predict(train = movie_train[1:100,-1],
#                                     test = movie_test[1:100,-1],
#                                     similarity = movie_train_simrank)
# save(movie_simrank_threshold,file = "movie_simrank_threshold.RData")
# 
# #movie_pearson_bestn
# neighborhood <- weight_bestn(movie_train_pearson)
# movie_pearson_bestn <- movie_predict(similarity = movie_train_pearson)
# save(movie_pearson_bestn,file = "movie_pearson_bestn.RData")
# #movie_vector_bestn
# neighborhood <- weight_bestn(movie_train_vector)
# movie_vector_bestn <- movie_predict(similarity = movie_train_vector)
# save(movie_vector_bestn,file = "movie_vector_bestn.RData")
# #movie_simrank_bestn
# neighborhood <- weight_bestn(movie_train_simrank)
# movie_simrank_bestn <- movie_predict(train = movie_train[1:100,-1],
#                                     test = movie_test[1:100,-1],
#                                     similarity = movie_train_simrank)
# save(movie_simrank_bestn,file = "movie_simrank_bestn.RData")
# 
# #movie_pearson_comb
# neighborhood <- weight_comb(movie_train_pearson)
# movie_pearson_comb <- movie_predict(similarity = movie_train_pearson)
# save(movie_pearson_comb,file = "movie_pearson_comb.RData")
# #movie_vector_comb
# neighborhood <- weight_comb(movie_train_vector)
# movie_vector_comb <- movie_predict(similarity = movie_train_vector)
# save(movie_vector_comb,file = "movie_vector_comb.RData")
# #movie_simrank_comb
# neighborhood <- weight_comb(movie_train_simrank)
# movie_simrank_comb <- movie_predict(train = movie_train[1:100,-1],
#                                     test = movie_test[1:100,-1],
#                                     similarity = movie_train_simrank)
# save(movie_simrank_comb,file = "movie_simrank_comb.RData")


# MS

```

## Evaluation
```{r}
## evaluation

# load data
setwd("~/GitHub/Spring2018-Project4-grp7/data")
test <- read.csv("movie_test.csv")
test <- test[,-1]

setwd("~/GitHub/Spring2018-Project4-grp7/output/memory_based_predict/movie")
load("movie_pearson_threshold.Rdata")
pred_pear_thr <- movie_pearson_threshold
load("movie_vector_threshold.Rdata")
pred_vec_thr <- movie_vector_threshold

load("movie_pearson_bestn.Rdata")
pred_pear_bn <- movie_pearson_bestn
load("movie_vector_bestn.Rdata")
pred_vec_bn <- movie_vector_bestn

load("movie_pearson_comb.Rdata")
pred_pear_cb <- movie_pearson_comb
load("movie_vector_comb.Rdata")
pred_vec_cb <- movie_vector_comb


## MAE

#function
mae <- function(pred, test){
  mae <- mean(abs(pred - test), na.rm = T)
  return(mae)
}

#output
mae(pred_pear_thr, as.matrix(test))
mae(pred_vec_thr, as.matrix(test))
mae(pred_pear_bn, as.matrix(test))
mae(pred_vec_bn, as.matrix(test))
mae(pred_pear_cb, as.matrix(test))
mae(pred_vec_cb, as.matrix(test))


## ROC

library("pROC")

# remove NA value
roc_mat <- matrix(4,nrow = nrow(pred_pear_thr),ncol = ncol(pred_pear_thr))
test_v_0 <- as.vector(as.matrix(test))
idx1 <- which(is.na(test_v_0)==T)

pred_pear_thr_v <- as.vector(pred_pear_thr)
idx2 <- which(is.na(pred_pear_thr_v)==T)
idx <- union(idx1,idx2)
pred_pear_thr_v <- pred_pear_thr_v[setdiff(1:length(test_v_0),idx)]
test_v <- test_v_0[setdiff(1:length(test_v_0),idx)]
roc_pear_thr <- roc(test_v,as.numeric(pred_pear_thr_v))
roc_pear_thr$auc
plot(roc_pear_thr)

pred_vec_thr_v <- as.vector(pred_vec_thr)
idx2 <- which(is.na(pred_vec_thr_v)==T)
idx <- union(idx1,idx2)
pred_vec_thr_v <- pred_vec_thr_v[setdiff(1:length(test_v_0),idx)]
test_v <- test_v_0[setdiff(1:length(test_v_0),idx)]
roc_vec_thr <- roc(test_v,as.numeric(pred_vec_thr_v))
roc_vec_thr$auc
plot(roc_vec_thr)
```


# Model-Based Algorithm
